<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWA Visualization - 2D Swimlanes (ReactFlow)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #fff;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .header p {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-top: 4px;
        }

        #visualization-container {
            width: 100%;
            height: calc(100vh - 70px);
            background: #fafafa;
            position: relative;
        }

        #lanes-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        #reactflow-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .info-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.8rem;
            z-index: 1000;
        }

        .lane-bg {
            position: absolute;
            left: 0;
            right: 0;
            display: flex;
            align-items: center;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.2);
        }

        .lane-label {
            position: absolute;
            left: 10px;
            top: 10px;
            background: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            z-index: 2;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/reactflow@11/dist/style.css" rel="stylesheet" />
</head>

<body>
    <div class="header">
        <div>
            <h1>AWA Visualization - 2D Swimlanes</h1>
            <p>Insurance Claims Workflow with ReactFlow + Dagre Layout</p>
        </div>
    </div>
    <div id="visualization-container">
        <div id="lanes-background"></div>
        <div id="reactflow-layer"></div>
    </div>
    <div class="info-panel"><strong>Interactive:</strong> Click on any activity node or edge to see details • Drag to
        pan • Scroll to zoom</div>

    <script src="https://unpkg.com/react@17/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://cdn.jsdelivr.net/npm/reactflow@11/dist/umd/index.min.js"></script>
    <script src="../sdk/javascript/awa-viz.js"></script>

    <script>
        // Embedded visualization data (no CORS issues)
        const visualizationData = {
            "visualization": {
                "id": "a1b2c3d4-0001-4000-8000-000000000001",
                "workflow_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
                "name": "Insurance Claims - Standard 2D View",
                "description": "Default 2D visualization with horizontal swim lanes organized by department",
                "view_type": "2d",
                "engine": "reactflow",
                "auto_layout": { "algorithm": "dagre", "direction": "lr", "node_spacing": 60, "rank_spacing": 120 },
                "lanes": [
                    { "id": "lane-customer", "name": "customer", "label": "Customer", "order_index": 0, "color": "#E3F2FD", "y_start": 0, "y_end": 100 },
                    { "id": "lane-ai-intake", "name": "ai_intake", "label": "AI Intake Agent", "order_index": 1, "color": "#E8F5E9", "y_start": 100, "y_end": 200 },
                    { "id": "lane-ai-analysis", "name": "ai_analysis", "label": "AI Analysis Agent", "order_index": 2, "color": "#FFF3E0", "y_start": 200, "y_end": 300 },
                    { "id": "lane-human-review", "name": "human_review", "label": "Claims Manager", "order_index": 3, "color": "#FCE4EC", "y_start": 300, "y_end": 400 }
                ],
                "node_positions_2d": [
                    { "id": "pos-001", "node_id": "act-claim-submission", "lane": "customer", "node_type": "activity", "description": "Customer submits insurance claim with supporting documents", "procedure": "1. Log into customer portal\n2. Navigate to 'File New Claim' section\n3. Fill out claim form with incident details\n4. Upload supporting documents (photos, receipts, police reports)\n5. Review and submit claim\n6. Receive confirmation number", "actor_type": "human", "role": "Policy Holder", "position": { "x": 50, "y": 35 }, "width": 180, "height": 60, "style": { "background_color": "#BBDEFB", "border_color": "#1976D2", "border_width": 2, "border_radius": 8 } },
                    { "id": "pos-002", "node_id": "act-initial-triage", "lane": "ai_intake", "node_type": "activity", "description": "AI agent performs initial claim validation and categorization", "procedure": "1. Extract claim data from submission\n2. Validate required fields are present\n3. Classify claim type (auto, property, health, etc.)\n4. Check policy status and coverage\n5. Perform duplicate claim detection\n6. Assign initial priority score\n7. Route to appropriate queue", "actor_type": "ai_agent", "role": "Intake Agent", "position": { "x": 300, "y": 135 }, "width": 180, "height": 60, "style": { "background_color": "#C8E6C9", "border_color": "#388E3C", "border_width": 2, "border_radius": 8 } },
                    { "id": "pos-003", "node_id": "act-document-analysis", "lane": "ai_analysis", "node_type": "activity", "description": "AI analyzes documents for fraud detection and claim validity", "procedure": "1. Apply OCR to extract text from images\n2. Identify document types (invoice, medical report, etc.)\n3. Extract key entities (amounts, dates, names)\n4. Cross-reference with claim form data\n5. Run fraud detection algorithms (anomaly detection, pattern matching)\n6. Calculate confidence scores for extracted data\n7. Flag suspicious elements for review\n8. Generate structured analysis report", "actor_type": "ai_agent", "role": "Document Analyst", "position": { "x": 550, "y": 235 }, "width": 180, "height": 60, "style": { "background_color": "#FFE0B2", "border_color": "#F57C00", "border_width": 2, "border_radius": 8 } },
                    { "id": "pos-004", "node_id": "dec-approval-routing", "lane": "ai_analysis", "node_type": "decision", "description": "Route to auto-approval or human review based on risk score", "procedure": "IF risk_score < 30 AND claim_amount < 5000 AND fraud_indicators == 0 THEN route_to='auto_approval' ELSE route_to='human_review'", "actor_type": "ai_agent", "role": "Decision Engine", "position": { "x": 800, "y": 225 }, "width": 80, "height": 80, "style": { "background_color": "#FFF9C4", "border_color": "#FBC02D", "border_width": 2 } },
                    { "id": "pos-005", "node_id": "act-auto-approval", "lane": "ai_intake", "node_type": "activity", "description": "Automatically approve low-risk claims and notify customer", "procedure": "1. Calculate approved amount based on policy coverage\n2. Generate payment authorization\n3. Update claim status to 'approved'\n4. Trigger payment processing\n5. Send approval email to customer\n6. Update internal CRM system\n7. Log approval in audit trail", "actor_type": "application", "role": "Approval System", "position": { "x": 1050, "y": 135 }, "width": 180, "height": 60, "style": { "background_color": "#A5D6A7", "border_color": "#388E3C", "border_width": 2, "border_radius": 8 } },
                    { "id": "pos-006", "node_id": "act-human-review", "lane": "human_review", "node_type": "activity", "description": "Claims manager reviews high-risk or exception cases", "procedure": "1. Open claim review dashboard\n2. Review claim details and AI analysis\n3. Examine all supporting documents\n4. Assess fraud risk indicators\n5. Verify policy coverage and limits\n6. Make approval/denial decision\n7. Enter decision rationale\n8. Approve payment or request additional information\n9. Notify customer of decision", "actor_type": "human", "role": "Claims Manager", "position": { "x": 1050, "y": 335 }, "width": 180, "height": 60, "style": { "background_color": "#F8BBD9", "border_color": "#C2185B", "border_width": 2, "border_radius": 8 } }
                ],
                "edge_routings": [
                    { "id": "route-001", "edge_id": "edge-claim-submission-to-triage", "source": "act-claim-submission", "target": "act-initial-triage", "curve_type": "smoothstep", "animated": true, "style": { "stroke_color": "#1976D2", "stroke_width": 2 } },
                    { "id": "route-002", "edge_id": "edge-triage-to-analysis", "source": "act-initial-triage", "target": "act-document-analysis", "curve_type": "smoothstep", "animated": true, "style": { "stroke_color": "#388E3C", "stroke_width": 2 } },
                    { "id": "route-003", "edge_id": "edge-analysis-to-decision", "source": "act-document-analysis", "target": "dec-approval-routing", "curve_type": "smoothstep", "animated": true, "style": { "stroke_color": "#F57C00", "stroke_width": 2 } },
                    { "id": "route-004", "edge_id": "edge-decision-to-auto", "source": "dec-approval-routing", "target": "act-auto-approval", "curve_type": "smoothstep", "animated": false, "label": "Auto", "style": { "stroke_color": "#388E3C", "stroke_width": 2 } },
                    { "id": "route-005", "edge_id": "edge-decision-to-human", "source": "dec-approval-routing", "target": "act-human-review", "curve_type": "smoothstep", "animated": false, "label": "Manual", "style": { "stroke_color": "#C2185B", "stroke_width": 2 } }
                ],
                "camera_2d": { "zoom": 0.85, "min_zoom": 0.3, "max_zoom": 2.5, "fit_view": true, "fit_padding": 80 },
                "animation": { "enabled": true, "transition_duration": 350 },
                "theme": { "background_color": "transparent", "grid_enabled": true, "grid_size": 20, "grid_color": "#E0E0E0" }
            }
        };

        // Render lanes as background
        function renderLanes(lanes, containerHeight) {
            const container = document.getElementById('lanes-background');
            const laneHeight = containerHeight / lanes.length;
            lanes.forEach((lane, i) => {
                const div = document.createElement('div');
                div.className = 'lane-bg';
                div.style.top = `${i * laneHeight}px`;
                div.style.height = `${laneHeight}px`;
                div.style.backgroundColor = lane.color || 'transparent';
                div.innerHTML = `<span class="lane-label">${lane.label || lane.name}</span>`;
                container.appendChild(div);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const viz = visualizationData.visualization;

            // Get container height ONCE for both lanes and ReactFlow
            const containerHeight = document.getElementById('visualization-container').clientHeight;

            // Render lanes with calculated height
            if (viz.lanes) renderLanes(viz.lanes, containerHeight);

            // Render ReactFlow with same container height
            AWAViz.render(document.getElementById('reactflow-layer'), visualizationData, { containerHeight });
        });
    </script>
</body>

</html>